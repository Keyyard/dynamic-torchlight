{"version":3,"sources":["../../scripts/main.ts"],"sourcesContent":["import {\r\n  Container,\r\n  EntityEquippableComponent,\r\n  EntityInventoryComponent,\r\n  EquipmentSlot,\r\n  ItemStack,\r\n  system,\r\n  world,\r\n  Player,\r\n} from \"@minecraft/server\";\r\n\r\nclass LightManager {\r\n  async light13(player: Player) {\r\n    player.runCommandAsync(`setblock ~ ~1 ~ light_block [\"block_light_level\"=13]`);\r\n    player.runCommandAsync(`fill ~4 ~2 ~4 ~-4 ~4 ~-4 air [] replace light_block [\"block_light_level\"=13]`);\r\n    player.runCommandAsync(`fill ~4 ~-1 ~4 ~-4 ~-2 ~-4 air [] replace light_block [\"block_light_level\"=13]`);\r\n    player.runCommandAsync(`fill ~4 ~2 ~4 ~1 ~ ~1 air [] replace light_block [\"block_light_level\"=13]`);\r\n    player.runCommandAsync(`fill ~-4 ~2 ~-4 ~-1 ~ ~-1 air [] replace light_block [\"block_light_level\"=13]`);\r\n    player.runCommandAsync(`fill ~4 ~2 ~-4 ~1 ~ ~-1 air [] replace light_block [\"block_light_level\"=13]`);\r\n    player.runCommandAsync(`fill ~-4 ~2 ~4 ~-1 ~ ~1 air [] replace light_block [\"block_light_level\"=13]`);\r\n    player.runCommandAsync(`fill ~-4 ~2 ~ ~-1 ~ ~ air [] replace light_block [\"block_light_level\"=13]`);\r\n    player.runCommandAsync(`fill ~4 ~2 ~ ~1 ~ ~ air [] replace light_block [\"block_light_level\"=13]`);\r\n    player.runCommandAsync(`fill ~ ~2 ~-4 ~ ~ ~-1 air [] replace light_block [\"block_light_level\"=13]`);\r\n    player.runCommandAsync(`fill ~ ~2 ~4 ~ ~ ~1 air [] replace light_block [\"block_light_level\"=13]`);\r\n  }\r\n  async light11(player: Player) {\r\n    player.runCommandAsync(`setblock ~ ~1 ~ light_block [\"block_light_level\"=11]`);\r\n    player.runCommandAsync(`fill ~4 ~2 ~4 ~-4 ~4 ~-4 air [] replace light_block [\"block_light_level\"=11]`);\r\n    player.runCommandAsync(`fill ~4 ~-1 ~4 ~-4 ~-2 ~-4 air [] replace light_block [\"block_light_level\"=11]`);\r\n    player.runCommandAsync(`fill ~4 ~2 ~4 ~1 ~ ~1 air [] replace light_block [\"block_light_level\"=11]`);\r\n    player.runCommandAsync(`fill ~-4 ~2 ~-4 ~-1 ~ ~-1 air [] replace light_block [\"block_light_level\"=11]`);\r\n    player.runCommandAsync(`fill ~4 ~2 ~-4 ~1 ~ ~-1 air [] replace light_block [\"block_light_level\"=11]`);\r\n    player.runCommandAsync(`fill ~-4 ~2 ~4 ~-1 ~ ~1 air [] replace light_block [\"block_light_level\"=11]`);\r\n    player.runCommandAsync(`fill ~-4 ~2 ~ ~-1 ~ ~ air [] replace light_block [\"block_light_level\"=11]`);\r\n    player.runCommandAsync(`fill ~4 ~2 ~ ~1 ~ ~ air [] replace light_block [\"block_light_level\"=11]`);\r\n    player.runCommandAsync(`fill ~ ~2 ~-4 ~ ~ ~-1 air [] replace light_block [\"block_light_level\"=11]`);\r\n    player.runCommandAsync(`fill ~ ~2 ~4 ~ ~ ~1 air [] replace light_block [\"block_light_level\"=11]`);\r\n  }\r\n  async light9(player: Player) {\r\n    player.runCommandAsync(`setblock ~ ~1 ~ light_block [\"block_light_level\"=9]`);\r\n    player.runCommandAsync(`fill ~4 ~2 ~4 ~-4 ~4 ~-4 air [] replace light_block [\"block_light_level\"=9]`);\r\n    player.runCommandAsync(`fill ~4 ~-1 ~4 ~-4 ~-2 ~-4 air [] replace light_block [\"block_light_level\"=9]`);\r\n    player.runCommandAsync(`fill ~4 ~2 ~4 ~1 ~ ~1 air [] replace light_block [\"block_light_level\"=9]`);\r\n    player.runCommandAsync(`fill ~-4 ~2 ~-4 ~-1 ~ ~-1 air [] replace light_block [\"block_light_level\"=9]`);\r\n    player.runCommandAsync(`fill ~4 ~2 ~-4 ~1 ~ ~-1 air [] replace light_block [\"block_light_level\"=9]`);\r\n    player.runCommandAsync(`fill ~-4 ~2 ~4 ~-1 ~ ~1 air [] replace light_block [\"block_light_level\"=9]`);\r\n    player.runCommandAsync(`fill ~-4 ~2 ~ ~-1 ~ ~ air [] replace light_block [\"block_light_level\"=9]`);\r\n    player.runCommandAsync(`fill ~4 ~2 ~ ~1 ~ ~ air [] replace light_block [\"block_light_level\"=9]`);\r\n    player.runCommandAsync(`fill ~ ~2 ~-4 ~ ~ ~-1 air [] replace light_block [\"block_light_level\"=9]`);\r\n    player.runCommandAsync(`fill ~ ~2 ~4 ~ ~ ~1 air [] replace light_block [\"block_light_level\"=9]`);\r\n  }\r\n  async no_light(player: Player) {\r\n    player.runCommandAsync(`fill ~4 ~2 ~4 ~-4 ~4 ~-4 air [] replace light_block`);\r\n    player.runCommandAsync(`fill ~4 ~-1 ~4 ~-4 ~-2 ~-4 air [] replace light_block`);\r\n    player.runCommandAsync(`fill ~4 ~2 ~4 ~1 ~ ~1 air [] replace light_block`);\r\n    player.runCommandAsync(`fill ~-4 ~2 ~-4 ~-1 ~ ~-1 air [] replace light_block`);\r\n    player.runCommandAsync(`fill ~4 ~2 ~-4 ~1 ~ ~-1 air [] replace light_block`);\r\n    player.runCommandAsync(`fill ~-4 ~2 ~4 ~-1 ~ ~1 air [] replace light_block`);\r\n    player.runCommandAsync(`fill ~-4 ~2 ~ ~-1 ~ ~ air [] replace light_block`);\r\n    player.runCommandAsync(`fill ~4 ~2 ~ ~1 ~ ~ air [] replace light_block`);\r\n    player.runCommandAsync(`fill ~ ~2 ~-4 ~ ~ ~-1 air [] replace light_block`);\r\n    player.runCommandAsync(`fill ~ ~2 ~4 ~ ~ ~1 air [] replace light_block`);\r\n  }\r\n}\r\n\r\nclass TorchlightManager {\r\n  private light13 = [\"torch_offhand\", \"minecraft:torch\"];\r\n  private light11 = [\"soul_torch\", \"soul_torch_offhand\"];\r\n  private light9 = [\"redstone_torch\", \"redstone_torch_offhand\"];\r\n\r\n  LightManagerInstance = new LightManager();\r\n  constructor() {\r\n    system.runInterval(() => this.updatePlayers());\r\n  }\r\n\r\n  private replaceItems(inventory: Container, oldTypeId: string, newTypeId: string) {\r\n    for (let i = 0; i < inventory.size; i++) {\r\n      const item = inventory.getItem(i);\r\n      if (item && item.typeId === oldTypeId) {\r\n        const newItem = new ItemStack(newTypeId, item.amount);\r\n        newItem.setLore([`ยง6placeable in offhand slot!`]);\r\n        inventory.setItem(i, newItem);\r\n      }\r\n    }\r\n  }\r\n\r\n  private updatePlayers() {\r\n    const players = world.getPlayers();\r\n    players.forEach((player) => this.updatePlayer(player));\r\n  }\r\n\r\n  private updatePlayer(player: Player) {\r\n    const inventory = player.getComponent(\"minecraft:inventory\") as EntityInventoryComponent;\r\n    if (!inventory) return;\r\n\r\n    const container = inventory.container;\r\n    if (container) {\r\n      this.replaceItems(container, \"minecraft:torch\", \"keyyard:torch_offhand\");\r\n      this.replaceItems(container, \"minecraft:redstone_torch\", \"keyyard:redstone_torch_offhand\");\r\n      this.replaceItems(container, \"minecraft:soul_torch\", \"keyyard:soul_torch_offhand\");\r\n    }\r\n\r\n    const equip = player.getComponent(EntityEquippableComponent.componentId) as EntityEquippableComponent;\r\n    const hand = equip?.getEquipment(EquipmentSlot.Mainhand);\r\n    const offhand = equip?.getEquipment(EquipmentSlot.Offhand);\r\n\r\n    this.updateHand(player, hand);\r\n    this.updateOffhand(player, offhand);\r\n  }\r\n\r\n  private updateHand(player: Player, hand: any) {\r\n    if (!hand && !player.hasTag(\"offhand\")) {\r\n      player.removeTag(\"mainhand\");\r\n      this.LightManagerInstance.no_light(player);\r\n    }\r\n\r\n    if (hand && !player.hasTag(\"offhand\")) {\r\n      this.light13.forEach((i) => {\r\n        if (hand.typeId.includes(i)) {\r\n          player.addTag(\"mainhand\");\r\n          this.LightManagerInstance.light13(player);\r\n        }\r\n      });\r\n      this.light11.forEach((i) => {\r\n        if (hand.typeId.includes(i)) {\r\n          player.addTag(\"mainhand\");\r\n          this.LightManagerInstance.light11(player);\r\n        }\r\n      });\r\n      this.light9.forEach((i) => {\r\n        if (hand.typeId.includes(i)) {\r\n          player.addTag(\"mainhand\");\r\n          this.LightManagerInstance.light9(player);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  private updateOffhand(player: Player, offhand: any) {\r\n    if (!offhand) {\r\n      player.removeTag(\"offhand\");\r\n      if (!player.hasTag(\"mainhand\")) {\r\n        this.LightManagerInstance.no_light(player);\r\n      }\r\n    } else {\r\n      if (offhand.typeId.includes(\"torch_offhand\")) {\r\n        player.addTag(\"offhand\");\r\n        this.LightManagerInstance.light13(player);\r\n      }\r\n      if (offhand.typeId.includes(\"soul_torch_offhand\")) {\r\n        player.addTag(\"offhand\");\r\n        this.LightManagerInstance.light11(player);\r\n      }\r\n      if (offhand.typeId.includes(\"redstone_torch_offhand\")) {\r\n        player.addTag(\"offhand\");\r\n        this.LightManagerInstance.light9(player);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nnew TorchlightManager();\r\n"],"mappings":"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","names":[],"file":"../scripts/main.js"}