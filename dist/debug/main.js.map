{"version":3,"sources":["../../scripts/main.ts","../../scripts/utils.ts","../../scripts/config.ts"],"sourcesContent":["import {\r\n  BlockPermutation,\r\n  EntityEquippableComponent,\r\n  EntityInventoryComponent,\r\n  EquipmentSlot,\r\n  Player,\r\n  system,\r\n  world,\r\n} from \"@minecraft/server\";\r\nimport { removeLightBlocks, replaceItems, setLightLevel } from \"./utils\";\r\nimport { light11, light13, light9 } from \"./config\";\r\n\r\nclass LightManager {\r\n  async light13(player: Player) {\r\n    await setLightLevel(player, 13);\r\n  }\r\n\r\n  async light11(player: Player) {\r\n    await setLightLevel(player, 11);\r\n  }\r\n\r\n  async light9(player: Player) {\r\n    await setLightLevel(player, 9);\r\n  }\r\n\r\n  async no_light(player: Player) {\r\n    const { x, y, z } = player.location;\r\n    const dimension = player.dimension;\r\n    removeLightBlocks(dimension, x, y, z);\r\n  }\r\n}\r\n\r\nclass TorchlightManager {\r\n  private LightManagerInstance = new LightManager();\r\n\r\n  constructor() {\r\n    system.runInterval(() => this.updatePlayers());\r\n  }\r\n\r\n  private updatePlayers() {\r\n    const players = world.getPlayers();\r\n    players.forEach((player) => this.updatePlayer(player));\r\n  }\r\n\r\n  private updatePlayer(player: Player) {\r\n    const inventory = player.getComponent(\"minecraft:inventory\") as EntityInventoryComponent;\r\n    if (!inventory) return;\r\n\r\n    const container = inventory.container;\r\n    if (container) {\r\n      replaceItems(container, \"minecraft:torch\", \"keyyard:torch_offhand\");\r\n      replaceItems(container, \"minecraft:redstone_torch\", \"keyyard:redstone_torch_offhand\");\r\n      replaceItems(container, \"minecraft:soul_torch\", \"keyyard:soul_torch_offhand\");\r\n    }\r\n\r\n    const equip = player.getComponent(EntityEquippableComponent.componentId) as EntityEquippableComponent;\r\n    const hand = equip?.getEquipment(EquipmentSlot.Mainhand);\r\n    const offhand = equip?.getEquipment(EquipmentSlot.Offhand);\r\n\r\n    this.updateHand(player, hand);\r\n    this.updateOffhand(player, offhand);\r\n  }\r\n\r\n  private updateHand(player: Player, hand: any) {\r\n    if (!hand && !player.hasTag(\"offhand\")) {\r\n      player.removeTag(\"mainhand\");\r\n      this.LightManagerInstance.no_light(player);\r\n    }\r\n\r\n    if (hand && !player.hasTag(\"offhand\")) {\r\n      light13.forEach((i) => {\r\n        if (hand.typeId.includes(i)) {\r\n          player.addTag(\"mainhand\");\r\n          this.LightManagerInstance.light13(player);\r\n        }\r\n      });\r\n      light11.forEach((i) => {\r\n        if (hand.typeId.includes(i)) {\r\n          player.addTag(\"mainhand\");\r\n          this.LightManagerInstance.light11(player);\r\n        }\r\n      });\r\n      light9.forEach((i) => {\r\n        if (hand.typeId.includes(i)) {\r\n          player.addTag(\"mainhand\");\r\n          this.LightManagerInstance.light9(player);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  private updateOffhand(player: Player, offhand: any) {\r\n    if (!offhand) {\r\n      player.removeTag(\"offhand\");\r\n      if (!player.hasTag(\"mainhand\")) {\r\n        this.LightManagerInstance.no_light(player);\r\n      }\r\n    } else {\r\n      if (offhand.typeId.includes(\"torch_offhand\")) {\r\n        player.addTag(\"offhand\");\r\n        this.LightManagerInstance.light13(player);\r\n      }\r\n      if (offhand.typeId.includes(\"soul_torch_offhand\")) {\r\n        player.addTag(\"offhand\");\r\n        this.LightManagerInstance.light11(player);\r\n      }\r\n      if (offhand.typeId.includes(\"redstone_torch_offhand\")) {\r\n        player.addTag(\"offhand\");\r\n        this.LightManagerInstance.light9(player);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nnew TorchlightManager();\r\n","import { BlockPermutation, Container, ItemStack, Player } from \"@minecraft/server\";\r\n\r\nexport function replaceItems(inventory: Container, oldTypeId: string, newTypeId: string) {\r\n  for (let i = 0; i < inventory.size; i++) {\r\n    const item = inventory.getItem(i);\r\n    if (item && item.typeId === oldTypeId) {\r\n      const newItem = new ItemStack(newTypeId, item.amount);\r\n      newItem.setLore([`ยง6placeable in offhand slot!`]);\r\n      inventory.setItem(i, newItem);\r\n    }\r\n  }\r\n}\r\n\r\nexport function removeLightBlocks(dimension: any, x: number, y: number, z: number) {\r\n  const radius = 4;\r\n  const height = 2;\r\n  const airBlock = BlockPermutation.resolve(\"minecraft:air\");\r\n  for (let dx = -radius; dx <= radius; dx++) {\r\n    for (let dy = -height; dy <= height; dy++) {\r\n      for (let dz = -radius; dz <= radius; dz++) {\r\n        if (dx === 0 && dy === 1 && dz === 0) continue;\r\n        const block = dimension.getBlock({ x: x + dx, y: y + dy, z: z + dz });\r\n        if (\r\n          block &&\r\n          [\"minecraft:light_block_13\", \"minecraft:light_block_11\", \"minecraft:light_block_9\"].includes(block.typeId)\r\n        ) {\r\n          block.setPermutation(airBlock);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport function setLightLevel(player: Player, level: number | null) {\r\n  const dimension = player.dimension;\r\n  const { x, y, z } = player.location;\r\n\r\n  if (level !== null) {\r\n    const centerBlock = dimension.getBlock({ x, y: y + 1, z });\r\n    if (centerBlock) {\r\n      const lightBlock = BlockPermutation.resolve(\"minecraft:light_block\", { block_light_level: level });\r\n      centerBlock.setPermutation(lightBlock);\r\n    }\r\n  }\r\n\r\n  removeLightBlocks(dimension, x, y, z);\r\n}\r\n","export const light13 = [\"torch_offhand\", \"minecraft:torch\"];\r\nexport const light11 = [\"soul_torch\", \"soul_torch_offhand\"];\r\nexport const light9 = [\"redstone_torch\", \"redstone_torch_offhand\"];\r\n"],"mappings":"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","names":[],"file":"../scripts/main.js"}